<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tugas Laporan Pengeluaran Keuangan Bulanan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #57cc99;
            --accent-color: #38a3a5;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --sidebar-width: 250px;
            --header-height: 70px;
            --tabungan-color: #9b59b6;
            --tabungan-light: #f3e6f8;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
        }

        /* LOGIN PAGE (DISEMBUNYIKAN) */
        .login-container {
            display: none; /* Disembunyikan */
        }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--dark-color);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            background-color: var(--primary-color);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header h2 i {
            color: var(--secondary-color);
        }

        .user-info {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: var(--accent-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .user-name {
            font-weight: 500;
        }

        .user-role {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .menu-list {
            padding: 20px 0;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.8);
            border-left: 4px solid transparent;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .menu-item.active {
            background-color: rgba(87, 204, 153, 0.1);
            color: var(--secondary-color);
            border-left-color: var(--secondary-color);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        /* MAIN CONTENT */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: all 0.3s;
        }

        .header {
            background-color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header-title p {
            color: #666;
            font-size: 0.9rem;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #144c63;
        }

        .btn-success {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #46b17f;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #d68910;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-tabungan {
            background-color: var(--tabungan-color);
            color: white;
        }

        .btn-tabungan:hover {
            background-color: #8e44ad;
        }

        /* CONTENT AREAS */
        .content-area {
            display: none;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 25px;
        }

        .content-area.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-color);
        }

        .content-header h2 {
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* REKENING SECTION */
        .rekening-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .rekening-card {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .rekening-card.tabungan-card {
            background: linear-gradient(135deg, var(--tabungan-color), #8e44ad);
        }

        .rekening-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .rekening-card:hover {
            transform: translateY(-5px);
        }

        .rekening-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .rekening-icon {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .tabungan-icon {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .rekening-info h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .rekening-info p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .rekening-saldo {
            font-size: 2rem;
            font-weight: bold;
            text-align: right;
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }

        .rekening-update {
            font-size: 0.8rem;
            opacity: 0.8;
            text-align: right;
            margin-top: 5px;
            position: relative;
            z-index: 1;
        }

        .rekening-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }

        /* DATA TABLE */
        .data-table-container {
            overflow-x: auto;
        }

        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .entries-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .entries-control select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-box input {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 250px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: var(--light-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .kas-masuk {
            color: var(--secondary-color);
            font-weight: 600;
        }

        .kas-keluar {
            color: var(--danger-color);
            font-weight: 600;
        }

        .tabungan-masuk {
            color: var(--tabungan-color);
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .btn-edit {
            background-color: #3498db;
            color: white;
        }

        .btn-delete {
            background-color: var(--danger-color);
            color: white;
        }

        /* FORM STYLES */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(56, 163, 165, 0.2);
        }

        /* DASHBOARD STATS */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.income {
            background-color: var(--secondary-color);
        }

        .stat-icon.expense {
            background-color: var(--danger-color);
        }

        .stat-icon.balance {
            background-color: var(--accent-color);
        }

        .stat-icon.rekening {
            background-color: var(--warning-color);
        }

        .stat-icon.tabungan {
            background-color: var(--tabungan-color);
        }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }

        /* PAGINATION */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .pagination-info {
            color: #666;
        }

        .pagination-controls {
            display: flex;
            gap: 10px;
        }

        .pagination-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        .pagination-btn:hover {
            background-color: #f5f5f5;
        }

        .pagination-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            margin-top: 30px;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-header h2 span,
            .user-name,
            .menu-item span {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .search-box input {
                width: 200px;
            }
            
            .stats-container,
            .rekening-container {
                grid-template-columns: 1fr;
            }
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease;
        }

        .notification.success {
            background-color: var(--secondary-color);
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        .notification.info {
            background-color: var(--accent-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
        }

        .notification.tabungan {
            background-color: var(--tabungan-color);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ddd;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #999;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            padding: 30px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--primary-color);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* SALDO REAL-TIME INDICATOR */
        .saldo-update {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        .saldo-update.positive {
            background-color: rgba(87, 204, 153, 0.2);
            color: var(--secondary-color);
        }

        .saldo-update.negative {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
        }

        .saldo-update.tabungan {
            background-color: rgba(155, 89, 182, 0.2);
            color: var(--tabungan-color);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* BANK SIMULATION */
        .bank-simulation {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .bank-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .bank-header h3 {
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bank-status {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--secondary-color);
            font-weight: 500;
        }

        .bank-status i {
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ROLE BADGES */
        .role-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .role-admin {
            background-color: #e74c3c;
            color: white;
        }

        .role-bendahara {
            background-color: #3498db;
            color: white;
        }

        .role-pengurus {
            background-color: #2ecc71;
            color: white;
        }

        .role-pengguna {
            background-color: #95a5a6;
            color: white;
        }

        /* TAB SWITCHER */
        .tab-switcher {
            display: flex;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 15px;
            text-align: center;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .tab-btn.kas-tab.active {
            color: var(--primary-color);
        }

        .tab-btn.tabungan-tab.active {
            color: var(--tabungan-color);
        }

        /* TRANSFER SECTION */
        .transfer-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .transfer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .transfer-header h3 {
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .transfer-info {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }

        /* TYPE BADGES */
        .type-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .type-kas {
            background-color: rgba(26, 95, 122, 0.1);
            color: var(--primary-color);
        }

        .type-tabungan {
            background-color: rgba(155, 89, 182, 0.1);
            color: var(--tabungan-color);
        }
    </style>
</head>
<body>
    <!-- LOGIN PAGE (DISEMBUNYIKAN) -->
    <div id="loginPage" class="login-container" style="display: none;">
        <!-- Login form disembunyikan -->
    </div>

    <!-- MAIN APPLICATION (Langsung ditampilkan) -->
    <div id="mainApp" style="display: flex;">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-coins"></i> <span>KAS & TABUNGAN</span></h2>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <div>
                    <div class="user-name" id="userName">Administrator</div>
                    <div class="user-role" id="userRole">Administrator</div>
                </div>
            </div>
            
            <div class="menu-list">
                <div class="menu-item active" data-target="beranda">
                    <i class="fas fa-home"></i>
                    <span>Beranda</span>
                </div>
                
                <div class="menu-item" data-target="rekening">
                    <i class="fas fa-wallet"></i>
                    <span>Rekening Kas & Tabungan</span>
                </div>
                
                <div class="menu-item" data-target="dataPengguna" id="menuDataPengguna">
                    <i class="fas fa-users"></i>
                    <span>Data Pengguna</span>
                </div>
                
                <div class="menu-item" data-target="jenisKas">
                    <i class="fas fa-tags"></i>
                    <span>Jenis Transaksi</span>
                </div>
                
                <div class="menu-item" data-target="transaksiKas">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transaksi Kas</span>
                </div>
                
                <div class="menu-item" data-target="tabungan">
                    <i class="fas fa-piggy-bank"></i>
                    <span>Transaksi Tabungan</span>
                </div>
                
                <div class="menu-item" data-target="transfer">
                    <i class="fas fa-random"></i>
                    <span>Transfer Dana</span>
                </div>
                
                <div class="menu-item" data-target="laporan">
                    <i class="fas fa-chart-bar"></i>
                    <span>Laporan</span>
                </div>
                
                <div class="menu-item" data-target="logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- HEADER -->
            <div class="header">
                <div class="header-title">
                    <h1>Tugas Laporan Pengeluaran Keuangan Bulanan</h1>
                    <p>per tahun 2026-2027</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-warning" id="resetDataBtn">
                        <i class="fas fa-redo"></i> Reset Data
                    </button>
                    <div class="current-date" id="currentDate">Selasa, 26 April 2017</div>
                </div>
            </div>

            <!-- BANK SIMULATION -->
            <div class="bank-simulation" id="bankSimulation">
                <div class="bank-header">
                    <h3><i class="fas fa-university"></i> Sistem Bank Real-Time</h3>
                    <div class="bank-status">
                        <i class="fas fa-circle"></i>
                        <span>TERHUBUNG</span>
                    </div>
                </div>
                <p>Sistem saldo diperbarui secara real-time seperti di bank. Setiap transaksi langsung mempengaruhi saldo rekening.</p>
            </div>

            <!-- DASHBOARD/BERANDA -->
            <div class="content-area active" id="beranda">
                <div class="content-header">
                    <h2><i class="fas fa-home"></i> Dashboard</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="refreshData">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- STATISTIK -->
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon income">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalPemasukan">Rp 0</h3>
                            <p>Total Pemasukan Kas</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon expense">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalPengeluaran">Rp 0</h3>
                            <p>Total Pengeluaran Kas</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon balance">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="saldoKas">
                                Rp 0
                                <span class="saldo-update positive" id="saldoChangeIndicator" style="display: none;">+0</span>
                            </h3>
                            <p>Saldo Kas Total</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon tabungan">
                            <i class="fas fa-savings"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="saldoTabungan">Rp 0</h3>
                            <p>Total Tabungan</p>
                        </div>
                    </div>
                </div>
                
                <!-- REKENING KAS & TABUNGAN -->
                <div class="content-header">
                    <h2><i class="fas fa-wallet"></i> Rekening Kas & Tabungan 
                        <span class="saldo-update positive" id="rekeningUpdateIndicator" style="display: none;">Diperbarui</span>
                    </h2>
                    <div class="header-actions">
                        <button class="btn btn-tabungan" id="tambahTabunganBtn">
                            <i class="fas fa-plus-circle"></i> Tambah Tabungan
                        </button>
                        <button class="btn btn-success" id="tambahRekeningBtn">
                            <i class="fas fa-plus-circle"></i> Tambah Rekening
                        </button>
                    </div>
                </div>
                
                <div class="rekening-container" id="rekeningDashboard">
                    <!-- Rekening akan ditampilkan di sini -->
                </div>
                
                <!-- TRANSAKSI TERBARU -->
                <div class="content-header">
                    <h2><i class="fas fa-history"></i> Transaksi Terbaru</h2>
                    <div class="header-actions">
                        <button class="btn btn-tabungan" id="tambahTabunganTransaksiBtn">
                            <i class="fas fa-plus-circle"></i> Tabungan Baru
                        </button>
                        <button class="btn btn-success" id="tambahTransaksiBtn">
                            <i class="fas fa-plus-circle"></i> Transaksi Baru
                        </button>
                    </div>
                </div>
                
                <div class="tab-switcher">
                    <div class="tab-btn kas-tab active" data-tab="kas">Transaksi Kas</div>
                    <div class="tab-btn tabungan-tab" data-tab="tabungan">Transaksi Tabungan</div>
                </div>
                
                <div class="data-table-container">
                    <table id="dashboardTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Rekening</th>
                                <th>Jenis</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                            </tr>
                        </thead>
                        <tbody id="dashboardTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                    
                    <div class="empty-state" id="emptyDashboard">
                        <i class="fas fa-file-invoice"></i>
                        <h3>Belum Ada Transaksi</h3>
                        <p>Tambahkan transaksi pertama Anda</p>
                    </div>
                </div>
            </div>

            <!-- REKENING KAS & TABUNGAN -->
            <div class="content-area" id="rekening">
                <div class="content-header">
                    <h2><i class="fas fa-wallet"></i> Kelola Rekening Kas & Tabungan</h2>
                    <div class="header-actions">
                        <button class="btn btn-warning" id="syncSaldoBtn">
                            <i class="fas fa-sync"></i> Sync Saldo
                        </button>
                        <button class="btn btn-tabungan" id="tambahTabunganMenuBtn">
                            <i class="fas fa-plus-circle"></i> Tambah Tabungan
                        </button>
                        <button class="btn btn-success" id="tambahRekeningMenuBtn">
                            <i class="fas fa-plus-circle"></i> Tambah Rekening
                        </button>
                    </div>
                </div>
                
                <div class="tab-switcher">
                    <div class="tab-btn kas-tab active" data-tab="semua">Semua Rekening</div>
                    <div class="tab-btn" data-tab="kas">Rekening Kas</div>
                    <div class="tab-btn tabungan-tab" data-tab="tabungan">Rekening Tabungan</div>
                </div>
                
                <div class="rekening-container" id="rekeningListContainer">
                    <!-- Daftar rekening akan ditampilkan di sini -->
                </div>
                
                <div class="empty-state" id="emptyRekening">
                    <i class="fas fa-wallet"></i>
                    <h3>Belum Ada Rekening</h3>
                    <p>Tambahkan rekening pertama untuk mengelola kas dan tabungan</p>
                </div>
            </div>

            <!-- DATA PENGGUNA -->
            <div class="content-area" id="dataPengguna">
                <div class="content-header">
                    <h2><i class="fas fa-users"></i> Data Pengguna</h2>
                    <button class="btn btn-success" id="tambahPenggunaBtn">
                        <i class="fas fa-user-plus"></i> Tambah Pengguna
                    </button>
                </div>
                
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>User ID</th>
                                <th>Nama</th>
                                <th>Jabatan</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="penggunaTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                    
                    <div class="empty-state" id="emptyPengguna">
                        <i class="fas fa-users"></i>
                        <h3>Belum Ada Data Pengguna</h3>
                        <p>Tambahkan pengguna pertama untuk mengelola sistem</p>
                    </div>
                </div>
            </div>

            <!-- JENIS TRANSAKSI -->
            <div class="content-area" id="jenisKas">
                <div class="content-header">
                    <h2><i class="fas fa-tags"></i> Jenis Transaksi</h2>
                    <button class="btn btn-success" id="tambahJenisTransaksiBtn">
                        <i class="fas fa-plus-circle"></i> Tambah Jenis
                    </button>
                </div>
                
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Kode</th>
                                <th>Nama Jenis</th>
                                <th>Kategori</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="jenisTransaksiTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                    
                    <div class="empty-state" id="emptyJenisTransaksi">
                        <i class="fas fa-tags"></i>
                        <h3>Belum Ada Jenis Transaksi</h3>
                        <p>Tambahkan jenis transaksi terlebih dahulu</p>
                    </div>
                </div>
            </div>

            <!-- TRANSAKSI KAS -->
            <div class="content-area" id="transaksiKas">
                <div class="content-header">
                    <h2><i class="fas fa-exchange-alt"></i> Transaksi Kas</h2>
                    <button class="btn btn-success" id="tambahTransaksiMenuBtn">
                        <i class="fas fa-plus-circle"></i> Transaksi Baru
                    </button>
                </div>
                
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Rekening</th>
                                <th>Jenis</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                                <th>Saldo Setelah</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="transaksiTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                    
                    <div class="empty-state" id="emptyTransaksi">
                        <i class="fas fa-exchange-alt"></i>
                        <h3>Belum Ada Transaksi</h3>
                        <p>Tambahkan transaksi pertama untuk mulai mencatat kas</p>
                    </div>
                </div>
            </div>

            <!-- TRANSAKSI TABUNGAN -->
            <div class="content-area" id="tabungan">
                <div class="content-header">
                    <h2><i class="fas fa-piggy-bank"></i> Transaksi Tabungan</h2>
                    <button class="btn btn-tabungan" id="tambahTabunganTransaksiMenuBtn">
                        <i class="fas fa-plus-circle"></i> Transaksi Tabungan
                    </button>
                </div>
                
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Tabungan</th>
                                <th>Jenis</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                                <th>Saldo Setelah</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tabunganTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                    
                    <div class="empty-state" id="emptyTabungan">
                        <i class="fas fa-piggy-bank"></i>
                        <h3>Belum Ada Transaksi Tabungan</h3>
                        <p>Tambahkan transaksi tabungan pertama</p>
                    </div>
                </div>
            </div>

            <!-- TRANSFER DANA -->
            <div class="content-area" id="transfer">
                <div class="content-header">
                    <h2><i class="fas fa-random"></i> Transfer Dana</h2>
                    <button class="btn btn-tabungan" id="tambahTransferBtn">
                        <i class="fas fa-exchange-alt"></i> Transfer Baru
                    </button>
                </div>
                
                <div class="transfer-section">
                    <div class="transfer-header">
                        <h3><i class="fas fa-info-circle"></i> Informasi Transfer</h3>
                    </div>
                    <div class="transfer-info">
                        <p><strong>Transfer antar rekening:</strong> Memindahkan dana antara rekening kas dan tabungan.</p>
                        <p><strong>Contoh penggunaan:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Dari Kas ke Tabungan (Menabung)</li>
                            <li>Dari Tabungan ke Kas (Penarikan tabungan)</li>
                            <li>Dari Kas ke Kas (Transfer antar rekening kas)</li>
                            <li>Dari Tabungan ke Tabungan (Transfer antar tabungan)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Dari</th>
                                <th>Ke</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="transferTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                    
                    <div class="empty-state" id="emptyTransfer">
                        <i class="fas fa-random"></i>
                        <h3>Belum Ada Transfer Dana</h3>
                        <p>Tambahkan transfer dana pertama</p>
                    </div>
                </div>
            </div>

            <!-- LAPORAN -->
            <div class="content-area" id="laporan">
                <div class="content-header">
                    <h2><i class="fas fa-chart-bar"></i> Laporan Keuangan</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="cetakLaporanBtn">
                            <i class="fas fa-print"></i> Cetak
                        </button>
                        <button class="btn btn-success" id="exportLaporanBtn">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="periodeAwal">Periode Awal</label>
                        <input type="date" id="periodeAwal">
                    </div>
                    <div class="form-group">
                        <label for="periodeAkhir">Periode Akhir</label>
                        <input type="date" id="periodeAkhir">
                    </div>
                    <div class="form-group">
                        <label for="filterRekening">Jenis Laporan</label>
                        <select id="filterJenisLaporan">
                            <option value="semua">Semua Transaksi</option>
                            <option value="kas">Hanya Kas</option>
                            <option value="tabungan">Hanya Tabungan</option>
                            <option value="transfer">Hanya Transfer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" id="filterLaporanBtn" style="margin-top: 8px;">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Jenis</th>
                                <th>Keterangan</th>
                                <th>Rekening</th>
                                <th>Pemasukan</th>
                                <th>Pengeluaran</th>
                                <th>Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="laporanTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr style="background-color: #f8f9fa; font-weight: bold;">
                                <td colspan="5" style="text-align: right;">TOTAL:</td>
                                <td class="kas-masuk" id="totalLaporanMasuk">Rp 0</td>
                                <td class="kas-keluar" id="totalLaporanKeluar">Rp 0</td>
                                <td id="saldoLaporan">Rp 0</td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div class="empty-state" id="emptyLaporan">
                        <i class="fas fa-chart-bar"></i>
                        <h3>Belum Ada Data Laporan</h3>
                        <p>Tidak ada transaksi untuk ditampilkan</p>
                    </div>
                </div>
            </div>

            <!-- FOOTER -->
            <footer>
                <p>Copyright Â© 2026 Sholahudin. | Sistem Pencatatan Pemasukan dan Pengeluaran Kas (S-P3K)</p>
                <p>Muhamad Sholahudin | Saldo diperbarui real-time | Sistem Kas & Tabungan Terpisah</p>
            </footer>
        </div>

        <!-- MODAL TAMBAH REKENING -->
        <div class="modal-overlay" id="modalRekening">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-plus-circle"></i> Tambah Rekening Kas</h3>
                    <button class="close-modal" id="closeRekeningModal">&times;</button>
                </div>
                <form id="formRekening">
                    <div class="form-group">
                        <label for="namaRekening">Nama Rekening *</label>
                        <input type="text" id="namaRekening" placeholder="Contoh: Kas Operasional, Kas Pembangunan" required>
                    </div>
                    <div class="form-group">
                        <label for="jenisRekening">Jenis Rekening *</label>
                        <select id="jenisRekening" required>
                            <option value="kas">Rekening Kas</option>
                            <option value="tabungan">Rekening Tabungan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="saldoAwal">Saldo Awal (Rp) *</label>
                        <input type="number" id="saldoAwal" min="0" value="0" required>
                        <small style="color: #666;">Saldo awal akan langsung tersedia di rekening</small>
                    </div>
                    <div class="form-group">
                        <label for="deskripsiRekening">Deskripsi</label>
                        <textarea id="deskripsiRekening" rows="3" placeholder="Deskripsi rekening..."></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-success" style="flex: 1;">
                            <i class="fas fa-save"></i> Simpan
                        </button>
                        <button type="button" class="btn btn-danger" id="cancelRekeningModal" style="flex: 1;">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- MODAL TAMBAH TRANSAKSI -->
        <div class="modal-overlay" id="modalTransaksi">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-exchange-alt"></i> Transaksi Kas Baru</h3>
                    <button class="close-modal" id="closeTransaksiModal">&times;</button>
                </div>
                <form id="formTransaksi">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tanggalTransaksi">Tanggal *</label>
                            <input type="date" id="tanggalTransaksi" required>
                        </div>
                        <div class="form-group">
                            <label for="jenisTransaksi">Jenis *</label>
                            <select id="jenisTransaksi" required>
                                <option value="">Pilih Jenis</option>
                                <option value="masuk">Pemasukan</option>
                                <option value="keluar">Pengeluaran</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="rekeningTransaksi">Rekening Kas *</label>
                        <select id="rekeningTransaksi" required>
                            <option value="">Pilih Rekening Kas</option>
                            <!-- Opsi rekening kas akan diisi oleh JavaScript -->
                        </select>
                        <small style="color: #666;">Hanya rekening kas yang ditampilkan</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="keteranganTransaksi">Keterangan *</label>
                        <input type="text" id="keteranganTransaksi" placeholder="Contoh: Donasi Jumat, Pembelian ATK" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jumlahTransaksi">Jumlah (Rp) *</label>
                            <input type="number" id="jumlahTransaksi" min="1" placeholder="0" required>
                        </div>
                        <div class="form-group">
                            <label for="kategoriTransaksi">Kategori</label>
                            <select id="kategoriTransaksi">
                                <option value="Umum">Umum</option>
                                <option value="Donasi">Donasi</option>
                                <option value="Operasional">Operasional</option>
                                <option value="Pembangunan">Pembangunan</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="saldoInfo" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: none;">
                        <p><strong>Saldo Saat Ini:</strong> <span id="currentSaldoInfo">Rp 0</span></p>
                        <p><strong>Saldo Setelah Transaksi:</strong> <span id="saldoAfterInfo">Rp 0</span></p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-success" style="flex: 1;">
                            <i class="fas fa-save"></i> Simpan
                        </button>
                        <button type="button" class="btn btn-danger" id="cancelTransaksiModal" style="flex: 1;">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- MODAL TAMBAH TRANSAKSI TABUNGAN -->
        <div class="modal-overlay" id="modalTabunganTransaksi">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-piggy-bank"></i> Transaksi Tabungan Baru</h3>
                    <button class="close-modal" id="closeTabunganTransaksiModal">&times;</button>
                </div>
                <form id="formTabunganTransaksi">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tanggalTabunganTransaksi">Tanggal *</label>
                            <input type="date" id="tanggalTabunganTransaksi" required>
                        </div>
                        <div class="form-group">
                            <label for="jenisTabunganTransaksi">Jenis *</label>
                            <select id="jenisTabunganTransaksi" required>
                                <option value="">Pilih Jenis</option>
                                <option value="masuk">Setoran</option>
                                <option value="keluar">Penarikan</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="tabunganTransaksi">Rekening Tabungan *</label>
                        <select id="tabunganTransaksi" required>
                            <option value="">Pilih Tabungan</option>
                            <!-- Opsi tabungan akan diisi oleh JavaScript -->
                        </select>
                        <small style="color: #666;">Hanya rekening tabungan yang ditampilkan</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="keteranganTabunganTransaksi">Keterangan *</label>
                        <input type="text" id="keteranganTabunganTransaksi" placeholder="Contoh: Setoran bulanan, Penarikan kebutuhan" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jumlahTabunganTransaksi">Jumlah (Rp) *</label>
                            <input type="number" id="jumlahTabunganTransaksi" min="1" placeholder="0" required>
                        </div>
                        <div class="form-group">
                            <label for="kategoriTabunganTransaksi">Kategori</label>
                            <select id="kategoriTabunganTransaksi">
                                <option value="Reguler">Reguler</option>
                                <option value="Darurat">Darurat</option>
                                <option value="Investasi">Investasi</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="saldoTabunganInfo" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: none;">
                        <p><strong>Saldo Tabungan Saat Ini:</strong> <span id="currentSaldoTabunganInfo">Rp 0</span></p>
                        <p><strong>Saldo Setelah Transaksi:</strong> <span id="saldoAfterTabunganInfo">Rp 0</span></p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-tabungan" style="flex: 1;">
                            <i class="fas fa-save"></i> Simpan
                        </button>
                        <button type="button" class="btn btn-danger" id="cancelTabunganTransaksiModal" style="flex: 1;">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- MODAL TRANSFER DANA -->
        <div class="modal-overlay" id="modalTransfer">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-random"></i> Transfer Dana</h3>
                    <button class="close-modal" id="closeTransferModal">&times;</button>
                </div>
                <form id="formTransfer">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tanggalTransfer">Tanggal *</label>
                            <input type="date" id="tanggalTransfer" required>
                        </div>
                        <div class="form-group">
                            <label for="jumlahTransfer">Jumlah (Rp) *</label>
                            <input type="number" id="jumlahTransfer" min="1" placeholder="0" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dariRekening">Dari Rekening *</label>
                            <select id="dariRekening" required>
                                <option value="">Pilih Sumber Dana</option>
                                <!-- Opsi rekening akan diisi oleh JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="keRekening">Ke Rekening *</label>
                            <select id="keRekening" required>
                                <option value="">Pilih Tujuan Dana</option>
                                <!-- Opsi rekening akan diisi oleh JavaScript -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="keteranganTransfer">Keterangan *</label>
                        <input type="text" id="keteranganTransfer" placeholder="Contoh: Transfer ke tabungan, Penarikan tabungan" required>
                    </div>
                    
                    <div id="infoTransfer" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <p><strong>Informasi Transfer:</strong></p>
                        <p id="transferTypeInfo">Pilih sumber dan tujuan dana terlebih dahulu</p>
                        <div id="saldoTransferInfo" style="display: none; margin-top: 10px;">
                            <p><strong>Saldo Sumber Saat Ini:</strong> <span id="currentSaldoTransferInfo">Rp 0</span></p>
                            <p><strong>Saldo Setelah Transfer:</strong> <span id="saldoAfterTransferInfo">Rp 0</span></p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-tabungan" style="flex: 1;">
                            <i class="fas fa-exchange-alt"></i> Transfer
                        </button>
                        <button type="button" class="btn btn-danger" id="cancelTransferModal" style="flex: 1;">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- MODAL TAMBAH PENGGUNA -->
        <div class="modal-overlay" id="modalPengguna">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-user-plus"></i> Tambah Pengguna Baru</h3>
                    <button class="close-modal" id="closePenggunaModal">&times;</button>
                </div>
                <form id="formPengguna">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="namaPengguna">Nama Lengkap *</label>
                            <input type="text" id="namaPengguna" placeholder="Masukkan nama lengkap" required>
                        </div>
                        <div class="form-group">
                            <label for="userIdPengguna">User ID *</label>
                            <input type="text" id="userIdPengguna" placeholder="Buat User ID unik" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="passwordPengguna">Password *</label>
                            <div class="password-container">
                                <input type="password" id="passwordPengguna" placeholder="Buat password" required>
                                <button type="button" class="toggle-password" id="togglePasswordPengguna">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="konfirmasiPassword">Konfirmasi Password *</label>
                            <div class="password-container">
                                <input type="password" id="konfirmasiPassword" placeholder="Ulangi password" required>
                                <button type="button" class="toggle-password" id="toggleKonfirmasiPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jabatanPengguna">Jabatan *</label>
                            <input type="text" id="jabatanPengguna" placeholder="Contoh: Bendahara, Sekretaris" required>
                        </div>
                        <div class="form-group">
                            <label for="rolePengguna">Role *</label>
                            <select id="rolePengguna" required>
                                <option value="admin">Administrator</option>
                                <option value="bendahara">Bendahara</option>
                                <option value="pengurus">Pengurus</option>
                                <option value="pengguna" selected>Pengguna Biasa</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="statusPengguna">Status</label>
                        <select id="statusPengguna">
                            <option value="Aktif" selected>Aktif</option>
                            <option value="Nonaktif">Nonaktif</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-success" style="flex: 1;">
                            <i class="fas fa-save"></i> Simpan Pengguna
                        </button>
                        <button type="button" class="btn btn-danger" id="cancelPenggunaModal" style="flex: 1;">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- MODAL RESET DATA -->
        <div class="modal-overlay" id="modalReset">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-exclamation-triangle"></i> Reset Data Sistem</h3>
                    <button class="close-modal" id="closeResetModal">&times;</button>
                </div>
                <div style="margin-bottom: 20px;">
                    <p style="color: var(--danger-color); font-weight: 500; margin-bottom: 10px;">
                        <i class="fas fa-exclamation-circle"></i> PERHATIAN: Tindakan ini akan menghapus semua data!
                    </p>
                    <p>Semua data akan direset ke keadaan awal:</p>
                    <ul style="margin-left: 20px; margin-top: 10px; color: #666;">
                        <li>Semua transaksi akan dihapus</li>
                        <li>Semua rekening akan dikembalikan ke default</li>
                        <li>Semua data pengguna akan direset</li>
                        <li>Saldo akan dikembalikan ke nilai awal</li>
                    </ul>
                    <p style="margin-top: 15px; color: #666;">Tindakan ini tidak dapat dibatalkan!</p>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-danger" id="confirmResetBtn" style="flex: 1;">
                        <i class="fas fa-redo"></i> Ya, Reset Semua Data
                    </button>
                    <button class="btn btn-primary" id="cancelResetModal" style="flex: 1;">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            </div>
        </div>

        <!-- NOTIFICATION -->
        <div id="notification" class="notification" style="display: none;"></div>
    </div>

    <script>
        // Data aplikasi - DIPERBAIKI DENGAN TABUNGAN
        let transaksiData = [];
        let tabunganData = [];
        let rekeningData = [];
        let transferData = [];
        let penggunaData = [];
        let jenisTransaksiData = [
            { kode: "JTM001", nama: "Donasi", kategori: "Pemasukan", status: "Aktif" },
            { kode: "JTM002", nama: "Iuran", kategori: "Pemasukan", status: "Aktif" },
            { kode: "JTM003", nama: "Operasional", kategori: "Pengeluaran", status: "Aktif" },
            { kode: "JTM004", nama: "Pembangunan", kategori: "Pengeluaran", status: "Aktif" }
        ];

        // Variabel untuk tracking perubahan saldo
        let lastTotalSaldo = 0;
        let saldoChangeHistory = [];

        // Variabel untuk user yang sedang login
        let currentUser = {
            id: 1,
            userId: "admin",
            password: "admin123",
            nama: "Administrator",
            jabatan: "Administrator",
            role: "admin",
            status: "Aktif",
            avatarInitial: "A",
            tanggalBergabung: "2026-01-01"
        };
        
        let isLoggedIn = true; // Langsung login

        // Data pengguna default
        const defaultUsers = [
            {
                id: 1,
                userId: "admin",
                password: "admin123",
                nama: "Administrator",
                jabatan: "Administrator",
                role: "admin",
                status: "Aktif",
                avatarInitial: "A",
                tanggalBergabung: "2026-01-01"
            },
            {
                id: 2,
                userId: "bendahara",
                password: "bendahara123",
                nama: "Bendahara",
                jabatan: "Bendahara",
                role: "bendahara",
                status: "Aktif",
                avatarInitial: "B",
                tanggalBergabung: "2026-01-01"
            }
        ];

        // Format tanggal Indonesia
        function formatDate(date) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(date).toLocaleDateString('id-ID', options);
        }

        // Format tanggal pendek
        function formatDateShort(date) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(date).toLocaleDateString('id-ID', options);
        }

        // Format tanggal waktu lengkap
        function formatDateTime(date) {
            const options = { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            return new Date(date).toLocaleDateString('id-ID', options);
        }

        // Format mata uang Rupiah
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Tampilkan notifikasi
        function showNotification(message, type = "success") {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = "block";
            
            setTimeout(() => {
                notification.style.display = "none";
            }, 3000);
        }

        // Simpan data ke localStorage
        function saveToLocalStorage() {
            localStorage.setItem('transaksiData', JSON.stringify(transaksiData));
            localStorage.setItem('tabunganData', JSON.stringify(tabunganData));
            localStorage.setItem('rekeningData', JSON.stringify(rekeningData));
            localStorage.setItem('transferData', JSON.stringify(transferData));
            localStorage.setItem('penggunaData', JSON.stringify(penggunaData));
            localStorage.setItem('jenisTransaksiData', JSON.stringify(jenisTransaksiData));
            localStorage.setItem('saldoChangeHistory', JSON.stringify(saldoChangeHistory));
        }

        // Muat data dari localStorage
        function loadFromLocalStorage() {
            const savedTransaksi = localStorage.getItem('transaksiData');
            const savedTabungan = localStorage.getItem('tabunganData');
            const savedRekening = localStorage.getItem('rekeningData');
            const savedTransfer = localStorage.getItem('transferData');
            const savedPengguna = localStorage.getItem('penggunaData');
            const savedJenis = localStorage.getItem('jenisTransaksiData');
            const savedHistory = localStorage.getItem('saldoChangeHistory');
            
            if (savedTransaksi) transaksiData = JSON.parse(savedTransaksi);
            if (savedTabungan) tabunganData = JSON.parse(savedTabungan);
            if (savedRekening) rekeningData = JSON.parse(savedRekening);
            if (savedTransfer) transferData = JSON.parse(savedTransfer);
            if (savedPengguna) penggunaData = JSON.parse(savedPengguna);
            if (savedJenis) jenisTransaksiData = JSON.parse(savedJenis);
            if (savedHistory) saldoChangeHistory = JSON.parse(savedHistory);
            
            // Jika penggunaData kosong, isi dengan default
            if (!penggunaData || penggunaData.length === 0) {
                penggunaData = JSON.parse(JSON.stringify(defaultUsers));
                saveToLocalStorage();
            }

            
            if (isLoggedIn) {
                updateAllDisplays();
            }
        }

        // Reset semua data ke keadaan awal
        function resetAllData() {
            // Konfirmasi reset
            if (!confirm("Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan!")) {
                return;
            }
            
            // Data default rekening
            rekeningData = [
             
            ];
            
            // Data transaksi kosong
            transaksiData = [];
            tabunganData = [];
            transferData = [];
            
            // Data pengguna default
            penggunaData = JSON.parse(JSON.stringify(defaultUsers));
            
            // Reset history saldo
            saldoChangeHistory = [];
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Update tampilan
            updateAllDisplays();
            showNotification('Semua data berhasil direset ke keadaan awal!', 'success');
            
            // Simpan waktu reset
            saldoChangeHistory.push({
                waktu: new Date().toISOString(),
                jenis: 'reset',
                keterangan: 'Reset semua data sistem',
                saldoSebelum: lastTotalSaldo,
                saldoSesudah: hitungTotalSaldoSemuaRekening()
            });
            
            saveToLocalStorage();
        }

        // Hitung saldo rekening tertentu - DIPERBAIKI
        function hitungSaldoRekening(namaRekening) {
            const rekening = rekeningData.find(r => r.nama === namaRekening);
            if (!rekening) return 0;
            
            // Mulai dari saldo awal
            let saldo = rekening.saldoAwal || 0;
            
            // Hitung transaksi berdasarkan jenis rekening
            if (rekening.jenis === "kas") {
                transaksiData.forEach(transaksi => {
                    if (transaksi.rekening === namaRekening) {
                        if (transaksi.jenis === 'masuk') {
                            saldo += transaksi.jumlah;
                        } else {
                            saldo -= transaksi.jumlah;
                        }
                    }
                });
            } else if (rekening.jenis === "tabungan") {
                tabunganData.forEach(transaksi => {
                    if (transaksi.tabungan === namaRekening) {
                        if (transaksi.jenis === 'masuk') {
                            saldo += transaksi.jumlah;
                        } else {
                            saldo -= transaksi.jumlah;
                        }
                    }
                });
            }
            
            // Hitung transfer
            transferData.forEach(transfer => {
                if (transfer.dari === namaRekening) {
                    saldo -= transfer.jumlah;
                }
                if (transfer.ke === namaRekening) {
                    saldo += transfer.jumlah;
                }
            });
            
            return saldo;
        }

        // Hitung total saldo semua rekening kas - DIPERBAIKI
        function hitungTotalSaldoSemuaRekening() {
            let totalSaldo = 0;
            
            rekeningData.forEach(rekening => {
                if (rekening.jenis === "kas") {
                    totalSaldo += hitungSaldoRekening(rekening.nama);
                }
            });
            
            return totalSaldo;
        }

        // Hitung total saldo semua tabungan - DIPERBAIKI
        function hitungTotalSaldoTabungan() {
            let totalTabungan = 0;
            
            rekeningData.forEach(rekening => {
                if (rekening.jenis === "tabungan") {
                    totalTabungan += hitungSaldoRekening(rekening.nama);
                }
            });
            
            return totalTabungan;
        }

        // Update indikator perubahan saldo
        function updateSaldoChangeIndicator() {
            const currentTotalSaldo = hitungTotalSaldoSemuaRekening();
            const change = currentTotalSaldo - lastTotalSaldo;
            
            const indicator = document.getElementById('saldoChangeIndicator');
            
            if (change !== 0) {
                indicator.textContent = change > 0 ? `+${formatCurrency(change)}` : formatCurrency(change);
                indicator.className = `saldo-update ${change > 0 ? 'positive' : 'negative'}`;
                indicator.style.display = 'inline-block';
                
                // Simpan perubahan ke history
                saldoChangeHistory.push({
                    waktu: new Date().toISOString(),
                    perubahan: change,
                    saldoSebelum: lastTotalSaldo,
                    saldoSesudah: currentTotalSaldo,
                    totalTransaksi: transaksiData.length
                });
                
                // Simpan ke localStorage
                saveToLocalStorage();
                
                // Update lastTotalSaldo
                lastTotalSaldo = currentTotalSaldo;
                
                // Hilangkan indikator setelah 5 detik
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 5000);
            }
        }

        // Update semua tampilan
        function updateAllDisplays() {
            updateDashboard();
            updateRekeningDisplay();
            updateTransaksiDisplay();
            updateTabunganDisplay();
            updateTransferDisplay();
            updatePenggunaDisplay();
            updateJenisTransaksiDisplay();
            updateLaporanDisplay();
            updateRekeningOptions();
            updateSaldoInfo();
        }

        // Update dashboard
        function updateDashboard() {
            // Hitung statistik
            let totalPemasukan = 0;
            let totalPengeluaran = 0;
            
            transaksiData.forEach(transaksi => {
                if (transaksi.jenis === 'masuk') {
                    totalPemasukan += transaksi.jumlah;
                } else {
                    totalPengeluaran += transaksi.jumlah;
                }
            });
            
            const saldoKas = hitungTotalSaldoSemuaRekening();
            const saldoTabungan = hitungTotalSaldoTabungan();
            
            // Update statistik
            document.getElementById('totalPemasukan').textContent = formatCurrency(totalPemasukan);
            document.getElementById('totalPengeluaran').textContent = formatCurrency(totalPengeluaran);
            document.getElementById('saldoKas').firstChild.textContent = formatCurrency(saldoKas);
            document.getElementById('saldoTabungan').textContent = formatCurrency(saldoTabungan);
            
            // Update tabel dashboard
            updateDashboardTable('kas');
            
            // Update rekening di dashboard
            updateRekeningDashboard();
            
            // Update indikator saldo
            updateSaldoChangeIndicator();
        }

        // Update tabel dashboard berdasarkan tab aktif
        function updateDashboardTable(tab) {
            const tableBody = document.getElementById('dashboardTableBody');
            const emptyState = document.getElementById('emptyDashboard');
            
            let dataToShow = [];
            if (tab === 'kas') {
                dataToShow = transaksiData;
            } else {
                dataToShow = tabunganData;
            }
            
            if (dataToShow.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                document.getElementById('dashboardTable').style.display = 'none';
            } else {
                emptyState.style.display = 'none';
                document.getElementById('dashboardTable').style.display = 'table';
                
                // Tampilkan 10 transaksi terbaru
                const recentTransactions = [...dataToShow]
                    .sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal))
                    .slice(0, 10);
                
                tableBody.innerHTML = '';
                recentTransactions.forEach((transaksi, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${formatDateShort(transaksi.tanggal)}</td>
                        <td>${tab === 'kas' ? transaksi.rekening : transaksi.tabungan}</td>
                        <td>${transaksi.jenis === 'masuk' ? (tab === 'kas' ? 'Pemasukan' : 'Setoran') : (tab === 'kas' ? 'Pengeluaran' : 'Penarikan')}</td>
                        <td>${transaksi.keterangan}</td>
                        <td class="${transaksi.jenis === 'masuk' ? (tab === 'kas' ? 'kas-masuk' : 'tabungan-masuk') : 'kas-keluar'}">
                            ${formatCurrency(transaksi.jumlah)}
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        // Update rekening di dashboard
        function updateRekeningDashboard() {
            const container = document.getElementById('rekeningDashboard');
            const emptyState = document.getElementById('emptyRekening');
            
            if (rekeningData.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                container.innerHTML = '';
                
                rekeningData.forEach(rekening => {
                    // Hitung saldo rekening
                    const saldo = hitungSaldoRekening(rekening.nama);
                    
                    const card = document.createElement('div');
                    card.className = `rekening-card ${rekening.jenis === 'tabungan' ? 'tabungan-card' : ''}`;
                    card.innerHTML = `
                        <div class="rekening-header">
                            <div class="rekening-info">
                                <h3>${rekening.nama}</h3>
                                <p><span class="type-badge ${rekening.jenis === 'kas' ? 'type-kas' : 'type-tabungan'}">${rekening.jenis === 'kas' ? 'Kas' : 'Tabungan'}</span> ${rekening.deskripsi || ''}</p>
                            </div>
                            <div class="rekening-icon ${rekening.jenis === 'tabungan' ? 'tabungan-icon' : ''}">
                                <i class="${rekening.jenis === 'kas' ? 'fas fa-wallet' : 'fas fa-piggy-bank'}"></i>
                            </div>
                        </div>
                        <div class="rekening-saldo">${formatCurrency(saldo)}</div>
                        <div class="rekening-update">Diperbarui: ${formatDateTime(new Date())}</div>
                        <div class="rekening-actions">
                            <button class="btn btn-primary btn-sm" onclick="lihatDetailRekening('${rekening.nama}')">
                                <i class="fas fa-eye"></i> Detail
                            </button>
                            ${rekening.jenis === 'kas' ? 
                                `<button class="btn btn-success btn-sm" onclick="tambahTransaksiUntukRekening('${rekening.nama}')">
                                    <i class="fas fa-plus"></i> Transaksi
                                </button>` :
                                `<button class="btn btn-tabungan btn-sm" onclick="tambahTabunganTransaksiUntukRekening('${rekening.nama}')">
                                    <i class="fas fa-plus"></i> Tabungan
                                </button>`
                            }
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        }

        // Update rekening display dengan filter
        function updateRekeningDisplay(filter = 'semua') {
            const container = document.getElementById('rekeningListContainer');
            const emptyState = document.getElementById('emptyRekening');
            
            // Filter rekening
            const filteredRekening = rekeningData.filter(rekening => {
                if (filter === 'semua') return true;
                return rekening.jenis === filter;
            });
            
            if (filteredRekening.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                container.innerHTML = '';
                
                filteredRekening.forEach((rekening, index) => {
                    // Hitung saldo rekening
                    const saldo = hitungSaldoRekening(rekening.nama);
                    
                    const card = document.createElement('div');
                    card.className = `rekening-card ${rekening.jenis === 'tabungan' ? 'tabungan-card' : ''}`;
                    card.innerHTML = `
                        <div class="rekening-header">
                            <div class="rekening-info">
                                <h3>${rekening.nama}</h3>
                                <p><span class="type-badge ${rekening.jenis === 'kas' ? 'type-kas' : 'type-tabungan'}">${rekening.jenis === 'kas' ? 'Kas' : 'Tabungan'}</span> ${rekening.deskripsi || ''}</p>
                            </div>
                            <div class="rekening-icon ${rekening.jenis === 'tabungan' ? 'tabungan-icon' : ''}">
                                <i class="${rekening.jenis === 'kas' ? 'fas fa-wallet' : 'fas fa-piggy-bank'}"></i>
                            </div>
                        </div>
                        <div class="rekening-saldo">${formatCurrency(saldo)}</div>
                        <div class="rekening-update">Saldo Awal: ${formatCurrency(rekening.saldoAwal || 0)}</div>
                        <div class="rekening-actions">
                            <button class="btn btn-primary btn-sm" onclick="editRekening(${rekeningData.indexOf(rekening)})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="hapusRekening(${rekeningData.indexOf(rekening)})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        }

        // Update transaksi kas display
        function updateTransaksiDisplay() {
            const tableBody = document.getElementById('transaksiTableBody');
            const emptyState = document.getElementById('emptyTransaksi');
            
            if (transaksiData.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                
                tableBody.innerHTML = '';
                transaksiData.forEach((transaksi, index) => {
                    // Hitung saldo setelah transaksi
                    const saldoSetelah = hitungSaldoRekening(transaksi.rekening);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${formatDateShort(transaksi.tanggal)}</td>
                        <td>${transaksi.rekening}</td>
                        <td>${transaksi.jenis === 'masuk' ? 'Pemasukan' : 'Pengeluaran'}</td>
                        <td>${transaksi.keterangan}</td>
                        <td class="${transaksi.jenis === 'masuk' ? 'kas-masuk' : 'kas-keluar'}">
                            ${formatCurrency(transaksi.jumlah)}
                        </td>
                        <td class="${saldoSetelah >= 0 ? 'kas-masuk' : 'kas-keluar'}">
                            ${formatCurrency(saldoSetelah)}
                        </td>
                        <td class="action-buttons">
                            <button class="btn btn-danger btn-sm" onclick="hapusTransaksi(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        // Update transaksi tabungan display
        function updateTabunganDisplay() {
            const tableBody = document.getElementById('tabunganTableBody');
            const emptyState = document.getElementById('emptyTabungan');
            
            if (tabunganData.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                
                tableBody.innerHTML = '';
                tabunganData.forEach((transaksi, index) => {
                    // Hitung saldo setelah transaksi
                    const saldoSetelah = hitungSaldoRekening(transaksi.tabungan);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${formatDateShort(transaksi.tanggal)}</td>
                        <td>${transaksi.tabungan}</td>
                        <td>${transaksi.jenis === 'masuk' ? 'Setoran' : 'Penarikan'}</td>
                        <td>${transaksi.keterangan}</td>
                        <td class="${transaksi.jenis === 'masuk' ? 'tabungan-masuk' : 'kas-keluar'}">
                            ${formatCurrency(transaksi.jumlah)}
                        </td>
                        <td class="${saldoSetelah >= 0 ? 'tabungan-masuk' : 'kas-keluar'}">
                            ${formatCurrency(saldoSetelah)}
                        </td>
                        <td class="action-buttons">
                            <button class="btn btn-danger btn-sm" onclick="hapusTabunganTransaksi(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        // Update transfer display
        function updateTransferDisplay() {
            const tableBody = document.getElementById('transferTableBody');
            const emptyState = document.getElementById('emptyTransfer');
            
            if (transferData.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                
                tableBody.innerHTML = '';
                transferData.forEach((transfer, index) => {
                    // Dapatkan jenis rekening
                    const dariRekening = rekeningData.find(r => r.nama === transfer.dari);
                    const keRekening = rekeningData.find(r => r.nama === transfer.ke);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${formatDateShort(transfer.tanggal)}</td>
                        <td>${transfer.dari} <span class="type-badge ${dariRekening?.jenis === 'kas' ? 'type-kas' : 'type-tabungan'}">${dariRekening?.jenis === 'kas' ? 'Kas' : 'Tabungan'}</span></td>
                        <td>${transfer.ke} <span class="type-badge ${keRekening?.jenis === 'kas' ? 'type-kas' : 'type-tabungan'}">${keRekening?.jenis === 'kas' ? 'Kas' : 'Tabungan'}</span></td>
                        <td>${transfer.keterangan}</td>
                        <td class="tabungan-masuk">${formatCurrency(transfer.jumlah)}</td>
                        <td><span style="color: green;">Berhasil</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-danger btn-sm" onclick="hapusTransfer(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        // Update pengguna display
        function updatePenggunaDisplay() {
            const tableBody = document.getElementById('penggunaTableBody');
            const emptyState = document.getElementById('emptyPengguna');
            
            if (penggunaData.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                
                tableBody.innerHTML = '';
                penggunaData.forEach((pengguna, index) => {
                    // Tentukan role badge
                    let roleClass = '';
                    let roleText = '';
                    
                    switch(pengguna.role) {
                        case 'admin':
                            roleClass = 'role-admin';
                            roleText = 'Admin';
                            break;
                        case 'bendahara':
                            roleClass = 'role-bendahara';
                            roleText = 'Bendahara';
                            break;
                        case 'pengurus':
                            roleClass = 'role-pengurus';
                            roleText = 'Pengurus';
                            break;
                        default:
                            roleClass = 'role-pengguna';
                            roleText = 'Pengguna';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${pengguna.userId}</td>
                        <td>${pengguna.nama}</td>
                        <td>${pengguna.jabatan}</td>
                        <td><span class="role-badge ${roleClass}">${roleText}</span></td>
                        <td><span style="color: ${pengguna.status === 'Aktif' ? 'green' : 'red'}">${pengguna.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-danger btn-sm" onclick="hapusPengguna(${index})" ${pengguna.role === 'admin' ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        // Update jenis transaksi display
        function updateJenisTransaksiDisplay() {
            const tableBody = document.getElementById('jenisTransaksiTableBody');
            const emptyState = document.getElementById('emptyJenisTransaksi');
            
            if (jenisTransaksiData.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                
                tableBody.innerHTML = '';
                jenisTransaksiData.forEach((jenis, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${jenis.kode}</td>
                        <td>${jenis.nama}</td>
                        <td>${jenis.kategori}</td>
                        <td><span style="color: ${jenis.status === 'Aktif' ? 'green' : 'red'}">${jenis.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-danger btn-sm" onclick="hapusJenisTransaksi(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        // Update laporan display - DIPERBAIKI untuk menghitung saldo awal
        function updateLaporanDisplay() {
            const tableBody = document.getElementById('laporanTableBody');
            const emptyState = document.getElementById('emptyLaporan');
            
            // Gabungkan semua data
            const allTransactions = [
                ...transaksiData.map(t => ({...t, jenisData: 'kas', jenisRekening: 'kas'})),
                ...tabunganData.map(t => ({...t, jenisData: 'tabungan', jenisRekening: 'tabungan', rekening: t.tabungan})),
                ...transferData.map(t => ({...t, jenisData: 'transfer'}))
            ].sort((a, b) => new Date(a.tanggal) - new Date(b.tanggal));
            
            // Hitung saldo awal total
            let totalSaldoAwal = 0;
            rekeningData.forEach(rekening => {
                totalSaldoAwal += rekening.saldoAwal || 0;
            });
            
            // Hitung total pemasukan dan pengeluaran dari transaksi
            let totalPemasukan = 0;
            let totalPengeluaran = 0;
            
            transaksiData.forEach(t => {
                if (t.jenis === 'masuk') {
                    totalPemasukan += t.jumlah;
                } else {
                    totalPengeluaran += t.jumlah;
                }
            });
            
            tabunganData.forEach(t => {
                if (t.jenis === 'masuk') {
                    totalPemasukan += t.jumlah;
                } else {
                    totalPengeluaran += t.jumlah;
                }
            });
            
            // Transfer tidak mempengaruhi total pemasukan/pengeluaran karena hanya pindah rekening
            // Tapi kita tetap hitung untuk laporan
            transferData.forEach(t => {
                totalPengeluaran += t.jumlah; // Dari rekening sumber
                totalPemasukan += t.jumlah;   // Ke rekening tujuan
                // Net effect = 0
            });
            
            // Hitung saldo total saat ini
            const saldoKasTotal = hitungTotalSaldoSemuaRekening();
            const saldoTabunganTotal = hitungTotalSaldoTabungan();
            const saldoTotal = saldoKasTotal + saldoTabunganTotal;
            
            if (allTransactions.length === 0 && totalSaldoAwal === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                document.getElementById('totalLaporanMasuk').textContent = formatCurrency(0);
                document.getElementById('totalLaporanKeluar').textContent = formatCurrency(0);
                document.getElementById('saldoLaporan').textContent = formatCurrency(0);
                return;
            }
            
            emptyState.style.display = 'none';
            
            tableBody.innerHTML = '';
            
            // Baris 1: Saldo Awal
            let saldoBerjalan = totalSaldoAwal;
            let rowNumber = 1;
            
            if (totalSaldoAwal > 0) {
                const saldoAwalRow = document.createElement('tr');
                saldoAwalRow.style.backgroundColor = '#f8f9fa';
                saldoAwalRow.innerHTML = `
                    <td>${rowNumber}</td>
                    <td>-</td>
                    <td><strong>SALDO AWAL</strong></td>
                    <td>Saldo awal semua rekening</td>
                    <td>Semua Rekening</td>
                    <td class="kas-masuk">${formatCurrency(totalSaldoAwal)}</td>
                    <td>-</td>
                    <td class="kas-masuk">${formatCurrency(saldoBerjalan)}</td>
                `;
                tableBody.appendChild(saldoAwalRow);
                rowNumber++;
            }
            
            // Tampilkan transaksi
            allTransactions.forEach((transaksi, index) => {
                let jenisText = '';
                let rekeningText = '';
                let pemasukan = 0;
                let pengeluaran = 0;
                
                if (transaksi.jenisData === 'kas') {
                    jenisText = transaksi.jenis === 'masuk' ? 'Pemasukan Kas' : 'Pengeluaran Kas';
                    rekeningText = transaksi.rekening;
                    
                    if (transaksi.jenis === 'masuk') {
                        pemasukan = transaksi.jumlah;
                        saldoBerjalan += transaksi.jumlah;
                    } else {
                        pengeluaran = transaksi.jumlah;
                        saldoBerjalan -= transaksi.jumlah;
                    }
                } else if (transaksi.jenisData === 'tabungan') {
                    jenisText = transaksi.jenis === 'masuk' ? 'Setoran Tabungan' : 'Penarikan Tabungan';
                    rekeningText = transaksi.tabungan;
                    
                    if (transaksi.jenis === 'masuk') {
                        pemasukan = transaksi.jumlah;
                        saldoBerjalan += transaksi.jumlah;
                    } else {
                        pengeluaran = transaksi.jumlah;
                        saldoBerjalan -= transaksi.jumlah;
                    }
                } else if (transaksi.jenisData === 'transfer') {
                    jenisText = 'Transfer Dana';
                    rekeningText = `${transaksi.dari} â ${transaksi.ke}`;
                    
                    // Transfer: mengurangi dari sumber, menambah ke tujuan
                    // Tapi dalam sistem gabungan, saldo total tidak berubah
                    // Karena hanya pindah dari satu rekening ke rekening lain
                    // Jadi tidak mempengaruhi saldoBerjalan
                    pengeluaran = transaksi.jumlah;
                    // Tidak mengubah saldoBerjalan karena hanya pindah rekening
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${rowNumber}</td>
                    <td>${formatDateShort(transaksi.tanggal)}</td>
                    <td>${jenisText}</td>
                    <td>${transaksi.keterangan}</td>
                    <td>${rekeningText}</td>
                    <td class="kas-masuk">${pemasukan > 0 ? formatCurrency(pemasukan) : '-'}</td>
                    <td class="kas-keluar">${pengeluaran > 0 ? formatCurrency(pengeluaran) : '-'}</td>
                    <td class="${saldoBerjalan >= 0 ? 'kas-masuk' : 'kas-keluar'}" style="font-weight: bold;">
                        ${formatCurrency(saldoBerjalan)}
                    </td>
                `;
                tableBody.appendChild(row);
                rowNumber++;
            });
            
            // Update total di footer
            document.getElementById('totalLaporanMasuk').textContent = formatCurrency(totalPemasukan);
            document.getElementById('totalLaporanKeluar').textContent = formatCurrency(totalPengeluaran);
            document.getElementById('saldoLaporan').textContent = formatCurrency(saldoTotal);
        }

        // Update opsi rekening di dropdown
        function updateRekeningOptions() {
            const selectTransaksi = document.getElementById('rekeningTransaksi');
            const selectTabungan = document.getElementById('tabunganTransaksi');
            const selectDari = document.getElementById('dariRekening');
            const selectKe = document.getElementById('keRekening');
            
            // Kosongkan opsi
            selectTransaksi.innerHTML = '<option value="">Pilih Rekening Kas</option>';
            selectTabungan.innerHTML = '<option value="">Pilih Tabungan</option>';
            selectDari.innerHTML = '<option value="">Pilih Sumber Dana</option>';
            selectKe.innerHTML = '<option value="">Pilih Tujuan Dana</option>';
            
            // Tambahkan opsi rekening
            rekeningData.forEach(rekening => {
                const option = document.createElement('option');
                option.value = rekening.nama;
                option.textContent = `${rekening.nama} (${rekening.jenis === 'kas' ? 'Kas' : 'Tabungan'})`;
                
                if (rekening.jenis === 'kas') {
                    selectTransaksi.appendChild(option.cloneNode(true));
                } else {
                    selectTabungan.appendChild(option.cloneNode(true));
                }
                
                selectDari.appendChild(option.cloneNode(true));
                selectKe.appendChild(option.cloneNode(true));
            });
        }

        // Update info saldo di modal transaksi
        function updateSaldoInfo() {
            // Untuk transaksi kas
            const rekeningSelect = document.getElementById('rekeningTransaksi');
            const saldoInfoDiv = document.getElementById('saldoInfo');
            const currentSaldoSpan = document.getElementById('currentSaldoInfo');
            const saldoAfterSpan = document.getElementById('saldoAfterInfo');
            const jumlahInput = document.getElementById('jumlahTransaksi');
            const jenisSelect = document.getElementById('jenisTransaksi');
            
            if (rekeningSelect) {
                rekeningSelect.addEventListener('change', updateSaldoDisplay);
                jumlahInput.addEventListener('input', updateSaldoDisplay);
                jenisSelect.addEventListener('change', updateSaldoDisplay);
                
                function updateSaldoDisplay() {
                    const selectedRekening = rekeningSelect.value;
                    const jumlah = parseInt(jumlahInput.value) || 0;
                    const jenis = jenisSelect.value;
                    
                    if (selectedRekening) {
                        const currentSaldo = hitungSaldoRekening(selectedRekening);
                        let saldoAfter = currentSaldo;
                        
                        if (jenis === 'masuk') {
                            saldoAfter += jumlah;
                        } else if (jenis === 'keluar') {
                            saldoAfter -= jumlah;
                        }
                        
                        // Update display
                        currentSaldoSpan.textContent = formatCurrency(currentSaldo);
                        saldoAfterSpan.textContent = formatCurrency(saldoAfter);
                        saldoInfoDiv.style.display = 'block';
                        
                        // Warna berdasarkan kondisi
                        if (jenis === 'keluar' && jumlah > currentSaldo) {
                            saldoAfterSpan.style.color = 'var(--danger-color)';
                            saldoAfterSpan.innerHTML = `${formatCurrency(saldoAfter)} <i class="fas fa-exclamation-triangle"></i>`;
                        } else {
                            saldoAfterSpan.style.color = saldoAfter >= 0 ? 'var(--secondary-color)' : 'var(--danger-color)';
                        }
                    } else {
                        saldoInfoDiv.style.display = 'none';
                    }
                }
            }
            
            // Untuk transaksi tabungan
            const tabunganSelect = document.getElementById('tabunganTransaksi');
            const saldoTabunganInfoDiv = document.getElementById('saldoTabunganInfo');
            const currentSaldoTabunganSpan = document.getElementById('currentSaldoTabunganInfo');
            const saldoAfterTabunganSpan = document.getElementById('saldoAfterTabunganInfo');
            const jumlahTabunganInput = document.getElementById('jumlahTabunganTransaksi');
            const jenisTabunganSelect = document.getElementById('jenisTabunganTransaksi');
            
            if (tabunganSelect) {
                tabunganSelect.addEventListener('change', updateSaldoTabunganDisplay);
                jumlahTabunganInput.addEventListener('input', updateSaldoTabunganDisplay);
                jenisTabunganSelect.addEventListener('change', updateSaldoTabunganDisplay);
                
                function updateSaldoTabunganDisplay() {
                    const selectedTabungan = tabunganSelect.value;
                    const jumlah = parseInt(jumlahTabunganInput.value) || 0;
                    const jenis = jenisTabunganSelect.value;
                    
                    if (selectedTabungan) {
                        const currentSaldo = hitungSaldoRekening(selectedTabungan);
                        let saldoAfter = currentSaldo;
                        
                        if (jenis === 'masuk') {
                            saldoAfter += jumlah;
                        } else if (jenis === 'keluar') {
                            saldoAfter -= jumlah;
                        }
                        
                        // Update display
                        currentSaldoTabunganSpan.textContent = formatCurrency(currentSaldo);
                        saldoAfterTabunganSpan.textContent = formatCurrency(saldoAfter);
                        saldoTabunganInfoDiv.style.display = 'block';
                        
                        // Warna berdasarkan kondisi
                        if (jenis === 'keluar' && jumlah > currentSaldo) {
                            saldoAfterTabunganSpan.style.color = 'var(--danger-color)';
                            saldoAfterTabunganSpan.innerHTML = `${formatCurrency(saldoAfter)} <i class="fas fa-exclamation-triangle"></i>`;
                        } else {
                            saldoAfterTabunganSpan.style.color = saldoAfter >= 0 ? 'var(--tabungan-color)' : 'var(--danger-color)';
                        }
                    } else {
                        saldoTabunganInfoDiv.style.display = 'none';
                    }
                }
            }
            
            // Untuk transfer
            const dariSelect = document.getElementById('dariRekening');
            const keSelect = document.getElementById('keRekening');
            const jumlahTransferInput = document.getElementById('jumlahTransfer');
            const transferInfo = document.getElementById('transferTypeInfo');
            const saldoTransferInfoDiv = document.getElementById('saldoTransferInfo');
            const currentSaldoTransferSpan = document.getElementById('currentSaldoTransferInfo');
            const saldoAfterTransferSpan = document.getElementById('saldoAfterTransferInfo');
            
            if (dariSelect) {
                dariSelect.addEventListener('change', updateTransferInfo);
                keSelect.addEventListener('change', updateTransferInfo);
                jumlahTransferInput.addEventListener('input', updateTransferInfo);
                
                function updateTransferInfo() {
                    const dari = dariSelect.value;
                    const ke = keSelect.value;
                    const jumlah = parseInt(jumlahTransferInput.value) || 0;
                    
                    if (dari && ke) {
                        if (dari === ke) {
                            transferInfo.innerHTML = '<span style="color: var(--danger-color);">Tidak bisa transfer ke rekening yang sama!</span>';
                            saldoTransferInfoDiv.style.display = 'none';
                            return;
                        }
                        
                        const dariRekening = rekeningData.find(r => r.nama === dari);
                        const keRekening = rekeningData.find(r => r.nama === ke);
                        
                        let typeInfo = '';
                        if (dariRekening.jenis === 'kas' && keRekening.jenis === 'tabungan') {
                            typeInfo = 'Transfer dari Kas ke Tabungan (Menabung)';
                        } else if (dariRekening.jenis === 'tabungan' && keRekening.jenis === 'kas') {
                            typeInfo = 'Transfer dari Tabungan ke Kas (Penarikan)';
                        } else if (dariRekening.jenis === 'kas' && keRekening.jenis === 'kas') {
                            typeInfo = 'Transfer antar Rekening Kas';
                        } else {
                            typeInfo = 'Transfer antar Tabungan';
                        }
                        
                        transferInfo.textContent = typeInfo;
                        
                        // Update saldo info
                        const currentSaldo = hitungSaldoRekening(dari);
                        const saldoAfter = currentSaldo - jumlah;
                        
                        currentSaldoTransferSpan.textContent = formatCurrency(currentSaldo);
                        saldoAfterTransferSpan.textContent = formatCurrency(saldoAfter);
                        saldoTransferInfoDiv.style.display = 'block';
                        
                        // Warna berdasarkan kondisi
                        if (jumlah > currentSaldo) {
                            saldoAfterTransferSpan.style.color = 'var(--danger-color)';
                            saldoAfterTransferSpan.innerHTML = `${formatCurrency(saldoAfter)} <i class="fas fa-exclamation-triangle"></i> Saldo tidak cukup!`;
                        } else {
                            saldoAfterTransferSpan.style.color = saldoAfter >= 0 ? 'var(--secondary-color)' : 'var(--danger-color)';
                        }
                    } else {
                        transferInfo.textContent = 'Pilih sumber dan tujuan dana terlebih dahulu';
                        saldoTransferInfoDiv.style.display = 'none';
                    }
                }
            }
        }

        // Tambah rekening baru (kas atau tabungan)
        function tambahRekening() {
            const nama = document.getElementById('namaRekening').value.trim();
            const jenis = document.getElementById('jenisRekening').value;
            const saldoAwal = parseInt(document.getElementById('saldoAwal').value) || 0;
            const deskripsi = document.getElementById('deskripsiRekening').value.trim();
            
            if (!nama) {
                showNotification('Nama rekening harus diisi!', 'error');
                return;
            }
            
            // Cek apakah nama rekening sudah ada
            if (rekeningData.some(r => r.nama.toLowerCase() === nama.toLowerCase())) {
                showNotification('Nama rekening sudah ada!', 'error');
                return;
            }
            
            // Tambahkan rekening baru
            const newRekening = {
                id: Date.now(),
                nama: nama,
                jenis: jenis,
                saldoAwal: saldoAwal,
                deskripsi: deskripsi,
                tanggalDibuat: new Date().toISOString().split('T')[0]
            };
            
            rekeningData.push(newRekening);
            saveToLocalStorage();
            updateAllDisplays();
            
            // Reset form
            document.getElementById('formRekening').reset();
            
            // Tutup modal
            document.getElementById('modalRekening').style.display = 'none';
            
            showNotification(`${jenis === 'kas' ? 'Rekening Kas' : 'Tabungan'} berhasil ditambahkan!`, 'success');
            
            // Update lastTotalSaldo jika kas
            if (jenis === 'kas') {
                lastTotalSaldo = hitungTotalSaldoSemuaRekening();
            }
        }

        // Edit rekening
        function editRekening(index) {
            const rekening = rekeningData[index];
            const newNama = prompt('Edit nama rekening:', rekening.nama);
            
            if (newNama && newNama.trim() !== '') {
                rekeningData[index].nama = newNama.trim();
                saveToLocalStorage();
                updateAllDisplays();
                showNotification('Rekening berhasil diubah!', 'success');
            }
        }

        // Hapus rekening
        function hapusRekening(index) {
            const rekening = rekeningData[index];
            
            // Cek apakah ada transaksi yang menggunakan rekening ini
            const transaksiTerhubung = rekening.jenis === 'kas' 
                ? transaksiData.filter(t => t.rekening === rekening.nama)
                : tabunganData.filter(t => t.tabungan === rekening.nama);
            
            // Cek apakah ada transfer yang menggunakan rekening ini
            const transferTerhubung = transferData.filter(t => t.dari === rekening.nama || t.ke === rekening.nama);
            
            if (transaksiTerhubung.length > 0 || transferTerhubung.length > 0) {
                showNotification(`Tidak dapat menghapus rekening karena ada ${transaksiTerhubung.length + transferTerhubung.length} transaksi terkait!`, 'error');
                return;
            }
            
            if (confirm(`Apakah Anda yakin ingin menghapus ${rekening.jenis === 'kas' ? 'rekening' : 'tabungan'} "${rekening.nama}"?`)) {
                rekeningData.splice(index, 1);
                saveToLocalStorage();
                updateAllDisplays();
                showNotification(`${rekening.jenis === 'kas' ? 'Rekening' : 'Tabungan'} berhasil dihapus!`, 'success');
                
                // Update lastTotalSaldo jika kas
                if (rekening.jenis === 'kas') {
                    lastTotalSaldo = hitungTotalSaldoSemuaRekening();
                }
            }
        }

        // Lihat detail rekening
        function lihatDetailRekening(namaRekening) {
            const rekening = rekeningData.find(r => r.nama === namaRekening);
            if (!rekening) return;
            
            const saldo = hitungSaldoRekening(namaRekening);
            
            let detail = `
${rekening.jenis === 'kas' ? 'REKENING KAS' : 'TABUNGAN'}
Nama: ${rekening.nama}
Jenis: ${rekening.jenis === 'kas' ? 'Kas' : 'Tabungan'}
Saldo Awal: ${formatCurrency(rekening.saldoAwal || 0)}
Saldo Saat Ini: ${formatCurrency(saldo)}
Deskripsi: ${rekening.deskripsi || 'Tidak ada deskripsi'}
            `;
            
            if (rekening.jenis === 'kas') {
                const transaksiRekening = transaksiData.filter(t => t.rekening === namaRekening);
                detail += `\nJumlah Transaksi Kas: ${transaksiRekening.length}`;
            } else {
                const transaksiTabungan = tabunganData.filter(t => t.tabungan === namaRekening);
                detail += `\nJumlah Transaksi Tabungan: ${transaksiTabungan.length}`;
            }
            
            const transferKeluar = transferData.filter(t => t.dari === namaRekening);
            const transferMasuk = transferData.filter(t => t.ke === namaRekening);
            detail += `\nTransfer Keluar: ${transferKeluar.length}`;
            detail += `\nTransfer Masuk: ${transferMasuk.length}`;
            
            alert(detail);
        }

        // Tambah transaksi untuk rekening tertentu
        function tambahTransaksiUntukRekening(namaRekening) {
            const rekening = rekeningData.find(r => r.nama === namaRekening);
            if (!rekening || rekening.jenis !== 'kas') {
                showNotification('Hanya bisa menambah transaksi untuk rekening kas!', 'error');
                return;
            }
            
            document.getElementById('rekeningTransaksi').value = namaRekening;
            document.getElementById('modalTransaksi').style.display = 'flex';
            updateSaldoInfo();
        }

        // Tambah transaksi tabungan untuk tabungan tertentu
        function tambahTabunganTransaksiUntukRekening(namaRekening) {
            const rekening = rekeningData.find(r => r.nama === namaRekening);
            if (!rekening || rekening.jenis !== 'tabungan') {
                showNotification('Hanya bisa menambah transaksi untuk tabungan!', 'error');
                return;
            }
            
            document.getElementById('tabunganTransaksi').value = namaRekening;
            document.getElementById('modalTabunganTransaksi').style.display = 'flex';
            updateSaldoInfo();
        }

        // Tambah transaksi kas baru
        function tambahTransaksiBaru() {
            const tanggal = document.getElementById('tanggalTransaksi').value;
            const jenis = document.getElementById('jenisTransaksi').value;
            const rekening = document.getElementById('rekeningTransaksi').value;
            const keterangan = document.getElementById('keteranganTransaksi').value.trim();
            const jumlah = parseInt(document.getElementById('jumlahTransaksi').value);
            const kategori = document.getElementById('kategoriTransaksi').value;
            
            // Validasi
            if (!tanggal || !jenis || !rekening || !keterangan || !jumlah) {
                showNotification('Harap lengkapi semua field yang wajib diisi!', 'error');
                return;
            }
            
            if (jumlah <= 0) {
                showNotification('Jumlah harus lebih dari 0!', 'error');
                return;
            }
            
            // Cek apakah rekening ada dan jenis kas
            const rekeningInfo = rekeningData.find(r => r.nama === rekening);
            if (!rekeningInfo || rekeningInfo.jenis !== 'kas') {
                showNotification('Pilih rekening kas yang valid!', 'error');
                return;
            }
            
            // Cek saldo jika transaksi pengeluaran
            if (jenis === 'keluar') {
                const saldoRekening = hitungSaldoRekening(rekening);
                
                if (jumlah > saldoRekening) {
                    showNotification(`Saldo tidak cukup! Saldo tersedia: ${formatCurrency(saldoRekening)}`, 'error');
                    return;
                }
            }
            
            // Buat transaksi baru
            const newTransaksi = {
                id: Date.now(),
                tanggal: tanggal,
                jenis: jenis,
                rekening: rekening,
                keterangan: keterangan,
                jumlah: jumlah,
                kategori: kategori,
                waktu: new Date().toISOString()
            };
            
            transaksiData.push(newTransaksi);
            saveToLocalStorage();
            updateAllDisplays();
            
            // Reset form
            document.getElementById('formTransaksi').reset();
            document.getElementById('tanggalTransaksi').valueAsDate = new Date();
            
            // Tutup modal
            document.getElementById('modalTransaksi').style.display = 'none';
            
            showNotification('Transaksi kas berhasil disimpan! Saldo diperbarui.', 'success');
            
            // Update lastTotalSaldo
            lastTotalSaldo = hitungTotalSaldoSemuaRekening();
        }

        // Tambah transaksi tabungan baru
        function tambahTabunganTransaksiBaru() {
            const tanggal = document.getElementById('tanggalTabunganTransaksi').value;
            const jenis = document.getElementById('jenisTabunganTransaksi').value;
            const tabungan = document.getElementById('tabunganTransaksi').value;
            const keterangan = document.getElementById('keteranganTabunganTransaksi').value.trim();
            const jumlah = parseInt(document.getElementById('jumlahTabunganTransaksi').value);
            const kategori = document.getElementById('kategoriTabunganTransaksi').value;
            
            // Validasi
            if (!tanggal || !jenis || !tabungan || !keterangan || !jumlah) {
                showNotification('Harap lengkapi semua field yang wajib diisi!', 'error');
                return;
            }
            
            if (jumlah <= 0) {
                showNotification('Jumlah harus lebih dari 0!', 'error');
                return;
            }
            
            // Cek apakah tabungan ada
            const tabunganInfo = rekeningData.find(r => r.nama === tabungan && r.jenis === 'tabungan');
            if (!tabunganInfo) {
                showNotification('Pilih tabungan yang valid!', 'error');
                return;
            }
            
            // Cek saldo jika penarikan
            if (jenis === 'keluar') {
                const saldoTabungan = hitungSaldoRekening(tabungan);
                
                if (jumlah > saldoTabungan) {
                    showNotification(`Saldo tabungan tidak cukup! Saldo tersedia: ${formatCurrency(saldoTabungan)}`, 'error');
                    return;
                }
            }
            
            // Buat transaksi tabungan baru
            const newTransaksi = {
                id: Date.now(),
                tanggal: tanggal,
                jenis: jenis,
                tabungan: tabungan,
                keterangan: keterangan,
                jumlah: jumlah,
                kategori: kategori,
                waktu: new Date().toISOString()
            };
            
            tabunganData.push(newTransaksi);
            saveToLocalStorage();
            updateAllDisplays();
            
            // Reset form
            document.getElementById('formTabunganTransaksi').reset();
            document.getElementById('tanggalTabunganTransaksi').valueAsDate = new Date();
            
            // Tutup modal
            document.getElementById('modalTabunganTransaksi').style.display = 'none';
            
            showNotification('Transaksi tabungan berhasil disimpan!', 'tabungan');
        }

        // Transfer dana
        function transferDana() {
            const tanggal = document.getElementById('tanggalTransfer').value;
            const dari = document.getElementById('dariRekening').value;
            const ke = document.getElementById('keRekening').value;
            const jumlah = parseInt(document.getElementById('jumlahTransfer').value);
            const keterangan = document.getElementById('keteranganTransfer').value.trim();
            
            // Validasi
            if (!tanggal || !dari || !ke || !jumlah || !keterangan) {
                showNotification('Harap lengkapi semua field!', 'error');
                return;
            }
            
            if (jumlah <= 0) {
                showNotification('Jumlah harus lebih dari 0!', 'error');
                return;
            }
            
            if (dari === ke) {
                showNotification('Tidak bisa transfer ke rekening yang sama!', 'error');
                return;
            }
            
            // Cek apakah rekening ada
            const dariRekening = rekeningData.find(r => r.nama === dari);
            const keRekening = rekeningData.find(r => r.nama === ke);
            
            if (!dariRekening || !keRekening) {
                showNotification('Rekening tidak ditemukan!', 'error');
                return;
            }
            
            // Cek saldo rekening sumber
            const saldoDari = hitungSaldoRekening(dari);
            if (jumlah > saldoDari) {
                showNotification(`Saldo tidak cukup! Saldo tersedia: ${formatCurrency(saldoDari)}`, 'error');
                return;
            }
            
            // Buat transfer baru
            const newTransfer = {
                id: Date.now(),
                tanggal: tanggal,
                dari: dari,
                ke: ke,
                jumlah: jumlah,
                keterangan: keterangan,
                waktu: new Date().toISOString(),
                status: 'Berhasil'
            };
            
            transferData.push(newTransfer);
            saveToLocalStorage();
            updateAllDisplays();
            
            // Reset form
            document.getElementById('formTransfer').reset();
            document.getElementById('tanggalTransfer').valueAsDate = new Date();
            
            // Tutup modal
            document.getElementById('modalTransfer').style.display = 'none';
            
            showNotification('Transfer dana berhasil!', 'success');
            
            // Update lastTotalSaldo jika transfer melibatkan kas
            if (dariRekening.jenis === 'kas' || keRekening.jenis === 'kas') {
                lastTotalSaldo = hitungTotalSaldoSemuaRekening();
            }
        }

        // Hapus transaksi kas
        function hapusTransaksi(index) {
            if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
                transaksiData.splice(index, 1);
                saveToLocalStorage();
                updateAllDisplays();
                showNotification('Transaksi berhasil dihapus!', 'success');
                
                // Update lastTotalSaldo
                lastTotalSaldo = hitungTotalSaldoSemuaRekening();
            }
        }

        // Hapus transaksi tabungan
        function hapusTabunganTransaksi(index) {
            if (confirm('Apakah Anda yakin ingin menghapus transaksi tabungan ini?')) {
                tabunganData.splice(index, 1);
                saveToLocalStorage();
                updateAllDisplays();
                showNotification('Transaksi tabungan berhasil dihapus!', 'tabungan');
            }
        }

        // Hapus transfer
        function hapusTransfer(index) {
            if (confirm('Apakah Anda yakin ingin menghapus transfer ini?')) {
                transferData.splice(index, 1);
                saveToLocalStorage();
                updateAllDisplays();
                showNotification('Transfer berhasil dihapus!', 'success');
                
                // Update lastTotalSaldo jika transfer melibatkan kas
                const transfer = transferData[index];
                if (transfer) {
                    const dariRekening = rekeningData.find(r => r.nama === transfer.dari);
                    const keRekening = rekeningData.find(r => r.nama === transfer.ke);
                    if (dariRekening?.jenis === 'kas' || keRekening?.jenis === 'kas') {
                        lastTotalSaldo = hitungTotalSaldoSemuaRekening();
                    }
                }
            }
        }

        // Tambah pengguna baru
        function tambahPenggunaBaru() {
            const nama = document.getElementById('namaPengguna').value.trim();
            const userId = document.getElementById('userIdPengguna').value.trim();
            const password = document.getElementById('passwordPengguna').value;
            const konfirmasiPassword = document.getElementById('konfirmasiPassword').value;
            const jabatan = document.getElementById('jabatanPengguna').value.trim();
            const role = document.getElementById('rolePengguna').value;
            const status = document.getElementById('statusPengguna').value;
            
            // Validasi
            if (!nama || !userId || !password || !konfirmasiPassword || !jabatan) {
                showNotification('Harap lengkapi semua field yang wajib diisi!', 'error');
                return;
            }
            
            if (password !== konfirmasiPassword) {
                showNotification('Password dan konfirmasi password tidak cocok!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password minimal 6 karakter!', 'error');
                return;
            }
            
            // Cek apakah User ID sudah ada
            if (penggunaData.some(u => u.userId.toLowerCase() === userId.toLowerCase())) {
                showNotification('User ID sudah digunakan!', 'error');
                return;
            }
            
            // Buat pengguna baru
            const newUser = {
                id: Date.now(),
                userId: userId,
                password: password,
                nama: nama,
                jabatan: jabatan,
                role: role,
                status: status,
                avatarInitial: nama.charAt(0).toUpperCase(),
                tanggalBergabung: new Date().toISOString().split('T')[0]
            };
            
            penggunaData.push(newUser);
            saveToLocalStorage();
            updatePenggunaDisplay();
            
            // Reset form
            document.getElementById('formPengguna').reset();
            
            // Tutup modal
            document.getElementById('modalPengguna').style.display = 'none';
            
            showNotification('Pengguna baru berhasil ditambahkan!', 'success');
        }

        // Hapus pengguna
        function hapusPengguna(index) {
            const pengguna = penggunaData[index];
            
            // Cek apakah pengguna adalah admin
            if (pengguna.role === 'admin') {
                showNotification('Tidak dapat menghapus pengguna dengan role Administrator!', 'error');
                return;
            }
            
            // Cek apakah pengguna sedang login
            if (currentUser && currentUser.userId === pengguna.userId) {
                showNotification('Tidak dapat menghapus akun yang sedang login!', 'error');
                return;
            }
            
            if (confirm(`Apakah Anda yakin ingin menghapus pengguna "${pengguna.nama}"?`)) {
                penggunaData.splice(index, 1);
                saveToLocalStorage();
                updatePenggunaDisplay();
                showNotification('Pengguna berhasil dihapus!', 'success');
            }
        }

        // Hapus jenis transaksi
        function hapusJenisTransaksi(index) {
            if (confirm('Apakah Anda yakin ingin menghapus jenis transaksi ini?')) {
                jenisTransaksiData.splice(index, 1);
                saveToLocalStorage();
                updateJenisTransaksiDisplay();
                showNotification('Jenis transaksi berhasil dihapus!', 'success');
            }
        }

        // Sync saldo (refresh data)
        function syncSaldo() {
            updateAllDisplays();
            showNotification('Saldo berhasil disinkronisasi!', 'success');
            
            // Animasi bank
            const bankStatus = document.querySelector('.bank-status i');
            bankStatus.style.animation = 'spin 1s linear';
            setTimeout(() => {
                bankStatus.style.animation = 'spin 2s linear infinite';
            }, 1000);
        }

        // Setup UI berdasarkan role user
        function setupUIForUser() {
            if (!currentUser) return;
            
            // Update user info di sidebar
            document.getElementById('userAvatar').textContent = currentUser.avatarInitial;
            document.getElementById('userName').textContent = currentUser.nama;
            
            // Update role display
            let roleText = '';
            switch(currentUser.role) {
                case 'admin':
                    roleText = 'Administrator';
                    break;
                case 'bendahara':
                    roleText = 'Bendahara';
                    break;
                case 'pengurus':
                    roleText = 'Pengurus';
                    break;
                default:
                    roleText = 'Pengguna Biasa';
            }
            document.getElementById('userRole').textContent = roleText;
            
            // Sembunyikan menu Data Pengguna jika bukan admin
            const menuDataPengguna = document.getElementById('menuDataPengguna');
            if (currentUser.role !== 'admin') {
                menuDataPengguna.style.display = 'none';
            } else {
                menuDataPengguna.style.display = 'flex';
            }
            
            // Update header dengan nama user
            const headerTitle = document.querySelector('.header-title h1');
            headerTitle.textContent = `Tugas Laporan Pengeluaran Keuangan Bulanan`;
        }

        // Logout function
        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                showNotification('Logout tidak diperlukan dalam mode bypass login', 'info');
            }
        }

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            // Set tanggal saat ini
            const now = new Date();
            document.getElementById('currentDate').textContent = formatDate(now);
            document.getElementById('tanggalTransaksi').valueAsDate = now;
            document.getElementById('tanggalTabunganTransaksi').valueAsDate = now;
            document.getElementById('tanggalTransfer').valueAsDate = now;
            document.getElementById('periodeAwal').valueAsDate = new Date(now.getFullYear(), now.getMonth(), 1);
            document.getElementById('periodeAkhir').valueAsDate = now;
            
            // Setup UI untuk user
            setupUIForUser();
            
            // Event listener untuk menu sidebar
            document.addEventListener('click', function(e) {
                if (e.target.closest('.menu-item')) {
                    const menuItem = e.target.closest('.menu-item');
                    
                    if (menuItem.classList.contains('active')) return;
                    
                    // Hapus class active dari semua menu
                    document.querySelectorAll('.menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Tambah class active ke menu yang diklik
                    menuItem.classList.add('active');
                    
                    // Sembunyikan semua konten
                    document.querySelectorAll('.content-area').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Tampilkan konten yang sesuai
                    const target = menuItem.getAttribute('data-target');
                    
                    if (target === 'logout') {
                        logout();
                        return;
                    }
                    
                    document.getElementById(target).classList.add('active');
                }
            });
            
            // Event listener untuk tab switcher di dashboard
            document.addEventListener('click', function(e) {
                if (e.target.closest('.tab-btn')) {
                    const tabBtn = e.target.closest('.tab-btn');
                    const tab = tabBtn.getAttribute('data-tab');
                    
                    // Hapus active dari semua tab
                    document.querySelectorAll('.tab-btn').forEach(tb => {
                        tb.classList.remove('active');
                    });
                    
                    // Tambah active ke tab yang diklik
                    tabBtn.classList.add('active');
                    
                    // Update tabel berdasarkan tab
                    if (window.location.hash === '#beranda' || document.getElementById('beranda').classList.contains('active')) {
                        updateDashboardTable(tab);
                    } else if (document.getElementById('rekening').classList.contains('active')) {
                        updateRekeningDisplay(tab);
                    }
                }
            });
            
            // Event listener untuk tombol reset
            document.getElementById('resetDataBtn').addEventListener('click', function() {
                // Hanya admin yang bisa reset data
                if (currentUser && currentUser.role !== 'admin') {
                    showNotification('Hanya Administrator yang dapat mereset data!', 'error');
                    return;
                }
                document.getElementById('modalReset').style.display = 'flex';
            });
            
            // Event listener untuk tombol sync saldo
            document.getElementById('syncSaldoBtn').addEventListener('click', syncSaldo);
            
            // Event listener untuk modal reset
            document.getElementById('closeResetModal').addEventListener('click', function() {
                document.getElementById('modalReset').style.display = 'none';
            });
            
            document.getElementById('cancelResetModal').addEventListener('click', function() {
                document.getElementById('modalReset').style.display = 'none';
            });
            
            document.getElementById('confirmResetBtn').addEventListener('click', function() {
                resetAllData();
                document.getElementById('modalReset').style.display = 'none';
            });
            
            // Event listener untuk tombol tambah rekening
            document.getElementById('tambahRekeningBtn').addEventListener('click', function() {
                document.getElementById('modalRekening').style.display = 'flex';
            });
            
            document.getElementById('tambahRekeningMenuBtn').addEventListener('click', function() {
                document.getElementById('modalRekening').style.display = 'flex';
            });
            
            // Event listener untuk tombol tambah tabungan
            document.getElementById('tambahTabunganBtn').addEventListener('click', function() {
                document.getElementById('jenisRekening').value = 'tabungan';
                document.getElementById('modalRekening').style.display = 'flex';
            });
            
            document.getElementById('tambahTabunganMenuBtn').addEventListener('click', function() {
                document.getElementById('jenisRekening').value = 'tabungan';
                document.getElementById('modalRekening').style.display = 'flex';
            });
            
            // Event listener untuk tombol tambah transaksi kas
            document.getElementById('tambahTransaksiBtn').addEventListener('click', function() {
                const adaRekeningKas = rekeningData.some(r => r.jenis === 'kas');
                if (!adaRekeningKas) {
                    showNotification('Buat rekening kas terlebih dahulu!', 'error');
                    return;
                }
                document.getElementById('modalTransaksi').style.display = 'flex';
                updateSaldoInfo();
            });
            
            document.getElementById('tambahTransaksiMenuBtn').addEventListener('click', function() {
                const adaRekeningKas = rekeningData.some(r => r.jenis === 'kas');
                if (!adaRekeningKas) {
                    showNotification('Buat rekening kas terlebih dahulu!', 'error');
                    return;
                }
                document.getElementById('modalTransaksi').style.display = 'flex';
                updateSaldoInfo();
            });
            
            // Event listener untuk tombol tambah transaksi tabungan
            document.getElementById('tambahTabunganTransaksiBtn').addEventListener('click', function() {
                const adaTabungan = rekeningData.some(r => r.jenis === 'tabungan');
                if (!adaTabungan) {
                    showNotification('Buat tabungan terlebih dahulu!', 'error');
                    return;
                }
                document.getElementById('modalTabunganTransaksi').style.display = 'flex';
                updateSaldoInfo();
            });
            
            document.getElementById('tambahTabunganTransaksiMenuBtn').addEventListener('click', function() {
                const adaTabungan = rekeningData.some(r => r.jenis === 'tabungan');
                if (!adaTabungan) {
                    showNotification('Buat tabungan terlebih dahulu!', 'error');
                    return;
                }
                document.getElementById('modalTabunganTransaksi').style.display = 'flex';
                updateSaldoInfo();
            });
            
            // Event listener untuk tombol tambah transfer
            document.getElementById('tambahTransferBtn').addEventListener('click', function() {
                if (rekeningData.length < 2) {
                    showNotification('Minimal butuh 2 rekening untuk transfer!', 'error');
                    return;
                }
                document.getElementById('modalTransfer').style.display = 'flex';
                updateSaldoInfo();
            });
            
            // Event listener untuk tombol tambah pengguna
            document.getElementById('tambahPenggunaBtn').addEventListener('click', function() {
                // Hanya admin yang bisa tambah pengguna
                if (currentUser && currentUser.role !== 'admin') {
                    showNotification('Hanya Administrator yang dapat menambah pengguna!', 'error');
                    return;
                }
                document.getElementById('modalPengguna').style.display = 'flex';
            });
            
            // Event listener untuk modal rekening
            document.getElementById('closeRekeningModal').addEventListener('click', function() {
                document.getElementById('modalRekening').style.display = 'none';
            });
            
            document.getElementById('cancelRekeningModal').addEventListener('click', function() {
                document.getElementById('modalRekening').style.display = 'none';
            });
            
            document.getElementById('formRekening').addEventListener('submit', function(e) {
                e.preventDefault();
                tambahRekening();
            });
            
            // Event listener untuk modal transaksi
            document.getElementById('closeTransaksiModal').addEventListener('click', function() {
                document.getElementById('modalTransaksi').style.display = 'none';
            });
            
            document.getElementById('cancelTransaksiModal').addEventListener('click', function() {
                document.getElementById('modalTransaksi').style.display = 'none';
            });
            
            document.getElementById('formTransaksi').addEventListener('submit', function(e) {
                e.preventDefault();
                tambahTransaksiBaru();
            });
            
            // Event listener untuk modal tabungan transaksi
            document.getElementById('closeTabunganTransaksiModal').addEventListener('click', function() {
                document.getElementById('modalTabunganTransaksi').style.display = 'none';
            });
            
            document.getElementById('cancelTabunganTransaksiModal').addEventListener('click', function() {
                document.getElementById('modalTabunganTransaksi').style.display = 'none';
            });
            
            document.getElementById('formTabunganTransaksi').addEventListener('submit', function(e) {
                e.preventDefault();
                tambahTabunganTransaksiBaru();
            });
            
            // Event listener untuk modal transfer
            document.getElementById('closeTransferModal').addEventListener('click', function() {
                document.getElementById('modalTransfer').style.display = 'none';
            });
            
            document.getElementById('cancelTransferModal').addEventListener('click', function() {
                document.getElementById('modalTransfer').style.display = 'none';
            });
            
            document.getElementById('formTransfer').addEventListener('submit', function(e) {
                e.preventDefault();
                transferDana();
            });
            
            // Event listener untuk modal pengguna
            document.getElementById('closePenggunaModal').addEventListener('click', function() {
                document.getElementById('modalPengguna').style.display = 'none';
            });
            
            document.getElementById('cancelPenggunaModal').addEventListener('click', function() {
                document.getElementById('modalPengguna').style.display = 'none';
            });
            
            document.getElementById('formPengguna')?.addEventListener('submit', function(e) {
                e.preventDefault();
                tambahPenggunaBaru();
            });
            
            // Event listener untuk tombol lainnya
            document.getElementById('refreshData').addEventListener('click', syncSaldo);
            
            document.getElementById('tambahJenisTransaksiBtn').addEventListener('click', function() {
                showNotification('Fitur tambah jenis transaksi akan segera tersedia', 'info');
            });
            
            document.getElementById('filterLaporanBtn').addEventListener('click', function() {
                showNotification('Filter laporan diterapkan', 'info');
            });
            
            document.getElementById('cetakLaporanBtn').addEventListener('click', function() {
                showNotification('Mencetak laporan...', 'info');
            });
            
            document.getElementById('exportLaporanBtn').addEventListener('click', function() {
                showNotification('Mengekspor laporan...', 'info');
            });
            
            // Inisialisasi data awal
            loadFromLocalStorage();
            updateAllDisplays();
            
            // Set lastTotalSaldo
            lastTotalSaldo = hitungTotalSaldoSemuaRekening();
            
            // Tampilkan notifikasi selamat datang
            showNotification('Selamat datang di Sistem Kas & Tabungan! Aplikasi siap digunakan.', 'success');
            
            // Auto-refresh saldo setiap 30 detik (simulasi real-time bank)
            setInterval(() => {
                if (isLoggedIn && (transaksiData.length > 0 || tabunganData.length > 0 || transferData.length > 0)) {
                    // Perbarui waktu update di rekening
                    const updateElements = document.querySelectorAll('.rekening-update');
                    if (updateElements.length > 0) {
                        updateElements.forEach(el => {
                            if (el.textContent.includes('Diperbarui:')) {
                                el.textContent = `Diperbarui: ${formatDateTime(new Date())}`;
                            }
                        });
                    }
                }
            }, 30000);
        });
    </script>
</body>
</html>